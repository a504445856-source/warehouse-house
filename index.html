<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>ğŸ“¦ Ù…Ø³ØªÙˆØ¯Ø¹ Ø§Ù„Ø¨ÙŠØª</title>
  <style>
    :root{--b:#2563eb;--bg:#f6f7fb;--card:#fff;--muted:#6b7280;--line:#e5e7eb;--danger:#dc2626}
    body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Tahoma,Arial;background:var(--bg);color:#111}
    header{position:sticky;top:0;background:rgba(246,247,251,.9);backdrop-filter:blur(8px);border-bottom:1px solid var(--line);z-index:5}
    header .wrap{max-width:980px;margin:auto;padding:12px 14px;display:flex;align-items:center;gap:10px}
    h1{margin:0;font-size:18px;display:flex;align-items:center;gap:8px}
    .pill{margin-inline-start:auto;font-size:12px;padding:4px 10px;border-radius:999px;border:1px solid var(--line);background:#fff;color:#111}
    main{max-width:980px;margin:auto;padding:14px;display:grid;gap:12px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:14px}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    @media (max-width:720px){.grid{grid-template-columns:1fr}}
    label{font-size:13px;color:#111;font-weight:600}
    input,select,textarea,button{font:inherit}
    input,select,textarea{
      width:100%;box-sizing:border-box;
      padding:10px 12px;border:1px solid var(--line);border-radius:12px;background:#fff;
      outline:none
    }
    textarea{min-height:84px;resize:vertical}
    .row{display:grid;gap:6px}
    .btns{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
    .btn{border:1px solid var(--line);background:#fff;padding:10px 14px;border-radius:12px;cursor:pointer}
    .btn-primary{background:var(--b);border-color:var(--b);color:#fff}
    .btn-dark{background:#111827;border-color:#111827;color:#fff}
    .btn-danger{background:var(--danger);border-color:var(--danger);color:#fff}
    .btn:disabled{opacity:.5;cursor:not-allowed}
    .sub{color:var(--muted);font-size:12px}
    .split{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .list{display:grid;gap:10px;margin-top:10px}
    .item{display:grid;grid-template-columns:72px 1fr auto;gap:10px;align-items:center;border:1px solid var(--line);border-radius:14px;padding:10px;background:#fff}
    .thumb{width:72px;height:72px;border-radius:12px;border:1px solid var(--line);display:grid;place-items:center;overflow:hidden;background:#fafafa}
    .thumb img{width:100%;height:100%;object-fit:cover}
    .name{font-weight:800}
    .actions{display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-end}
    .actions .btn{padding:8px 10px;border-radius:10px}
    .filters{display:flex;gap:10px;flex-wrap:wrap}
    .notice{background:#fff7ed;border:1px solid #fed7aa;color:#7c2d12;padding:10px 12px;border-radius:12px}
    .hidden{display:none!important}
    .toast{position:fixed;left:50%;bottom:22px;transform:translateX(-50%);background:#111827;color:#fff;padding:10px 14px;border-radius:999px;opacity:0;pointer-events:none;transition:.2s}
    .toast.show{opacity:1}
  </style>
</head>
<body>
<header>
  <div class="wrap">
    <h1>ğŸ“¦ Ù…Ø³ØªÙˆØ¯Ø¹ Ø§Ù„Ø¨ÙŠØª</h1>
    <span id="syncState" class="pill">Ø¬Ø§Ù‡Ø²</span>
  </div>
</header>

<main>
  <section class="card">
    <div class="split">
      <div class="pill" id="modePill">ÙˆØ¶Ø¹ Ø§Ù„Ø¥Ø¶Ø§ÙØ©</div>
      <div class="sub">ÙŠØ­ÙØ¸ Ù…Ø­Ù„ÙŠÙ‹Ø§ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§. â€œÙ…Ø²Ø§Ù…Ù†Ø©â€ ØªØ­Ø§ÙˆÙ„ Ø±ÙØ¹/ØªØ­Ù…ÙŠÙ„ Ù…Ù† Google Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…Ø³Ù…ÙˆØ­.</div>
    </div>

    <div class="grid" style="margin-top:10px">
      <div class="row">
        <label>Ø§Ø³Ù… Ø§Ù„ØºØ±Ø¶</label>
        <input id="name" placeholder="Ø§Ø³Ù… Ø§Ù„ØºØ±Ø¶ (Ù…Ø«Ø§Ù„: Ø¨Ø±Ø§Ø¯)"/>
      </div>
      <div class="row">
        <label>Ø§Ù„ØªØµÙ†ÙŠÙ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
        <select id="category">
          <option value="">â€”</option>
          <option>Ù…Ø·Ø¨Ø®</option><option>ØºØ±ÙØ©</option><option>Ù…Ø³ØªÙˆØ¯Ø¹</option>
          <option>Ø£Ø¯ÙˆØ§Øª</option><option>ÙˆØ±Ù‚</option><option>Ù…Ù„Ø§Ø¨Ø³</option>
        </select>
      </div>

      <div class="row">
        <label>Ø±Ù‚Ù… Ø§Ù„Ø±Ù *</label>
        <select id="shelf">
          <option value="">â€”</option>
          <option>Ø±Ù 1</option><option>Ø±Ù 2</option><option>Ø±Ù 3</option><option>Ø±Ù 4</option>
          <option>Ø±Ù 5</option><option>Ø±Ù 6</option><option>Ø±Ù 7</option><option>Ø±Ù 8</option>
        </select>
      </div>
      <div class="row">
        <label>Ø§Ù„Ø¬Ù‡Ø©</label>
        <select id="side">
          <option value="">â€”</option>
          <option>ÙŠÙ…ÙŠÙ†</option><option>ÙŠØ³Ø§Ø±</option><option>ÙˆØ³Ø·</option>
        </select>
      </div>

      <div class="row">
        <label>Ø§Ù„Ù…Ø³ØªÙˆÙ‰</label>
        <select id="level">
          <option value="">â€”</option>
          <option>Ø³ÙÙ„ÙŠ</option><option>ÙˆØ³Ø·</option><option>Ø¹Ù„ÙˆÙŠ</option>
        </select>
      </div>

      <div class="row">
        <label>Ù…Ù†Ø·Ù‚Ø©/Ù‚Ø³Ù… (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
        <input id="zone" placeholder="Ù…Ù†Ø·Ù‚Ø©/Ù‚Ø³Ù… (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)"/>
      </div>

      <div class="row" style="grid-column:1/-1">
        <label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
        <textarea id="notes" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª (Ù…Ø«Ø§Ù„: Ø¯Ø§Ø®Ù„ ØµÙ†Ø¯ÙˆÙ‚ Ø£Ø³ÙˆØ¯)"></textarea>
      </div>

      <div class="row" style="grid-column:1/-1">
        <label>ØµÙˆØ±Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
        <input id="image" type="file" accept="image/*" capture="environment"/>
        <div class="sub">ØªÙ‚Ø¯Ø± ØªØ®ØªØ§Ø± ØµÙˆØ±Ø© Ø£Ùˆ ØªÙØªØ­ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ù…Ø¨Ø§Ø´Ø±Ø©.</div>
      </div>
    </div>

    <div class="btns">
      <button class="btn btn-primary" id="btnSave">Ø­ÙØ¸</button>
      <button class="btn" id="btnClear">Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„</button>
      <button class="btn btn-dark" id="btnSync">Ù…Ø²Ø§Ù…Ù†Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</button>
      <button class="btn btn-danger hidden" id="btnDelete">Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØºØ±Ø¶</button>
    </div>

    <div class="notice" style="margin-top:10px">
      ğŸ”¸ <b>Ù…Ù‡Ù…:</b> Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© ØªØ­ÙØ¸ Ù…Ø­Ù„ÙŠÙ‹Ø§ ÙÙŠ Ù†ÙØ³ Ø§Ù„Ø¬ÙˆØ§Ù„. Ø¥Ø°Ø§ ØªØ¨ÙŠ ÙƒÙ„ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© ØªØ´ÙˆÙ Ù†ÙØ³ Ø§Ù„Ø£Ø´ÙŠØ§Ø¡ Ø§Ø³ØªØ®Ø¯Ù… Ø²Ø± <b>Ù…Ø²Ø§Ù…Ù†Ø©</b> (ÙˆÙŠØ¨Ù‚Ù‰ ÙŠØ­ØªØ§Ø¬ Ù†Øª ÙˆÙ†Ø¬Ø§Ø­ Ø§Ù„Ø§ØªØµØ§Ù„).
      <br/>Ø¥Ø°Ø§ ÙƒÙ†Øª Ø¹Ù„Ù‰ iPhone/Safari ÙˆÙØªØ­Øª Ù…Ù† â€œØ§Ù„ØªØµÙØ­ Ø§Ù„Ø®Ø§Øµâ€ Ù…Ù…ÙƒÙ† Ø§Ù„ØªØ®Ø²ÙŠÙ† ÙŠØ±ÙˆØ­ Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ØºÙ„Ø§Ù‚.
    </div>

    <input id="editId" type="hidden"/>
    <input id="editImageDataUrl" type="hidden"/>
  </section>

  <section class="card">
    <h2 style="margin:0 0 8px;font-size:16px">Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„Ø¹Ø±Ø¶</h2>
    <div class="filters">
      <input id="search" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù…/..." style="flex:1;min-width:180px"/>
      <select id="filterShelf">
        <option value="">ÙƒÙ„ Ø§Ù„Ø±ÙÙˆÙ</option>
        <option>Ø±Ù 1</option><option>Ø±Ù 2</option><option>Ø±Ù 3</option><option>Ø±Ù 4</option>
        <option>Ø±Ù 5</option><option>Ø±Ù 6</option><option>Ø±Ù 7</option><option>Ø±Ù 8</option>
      </select>
      <select id="filterCat">
        <option value="">ÙƒÙ„ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª</option>
        <option>Ù…Ø·Ø¨Ø®</option><option>ØºØ±ÙØ©</option><option>Ù…Ø³ØªÙˆØ¯Ø¹</option>
        <option>Ø£Ø¯ÙˆØ§Øª</option><option>ÙˆØ±Ù‚</option><option>Ù…Ù„Ø§Ø¨Ø³</option>
      </select>
    </div>

    <div class="sub" style="margin-top:8px">Ø¹Ø¯Ø¯ Ø§Ù„Ø£ØºØ±Ø§Ø¶: <b id="count">0</b></div>
    <div id="list" class="list"></div>
    <div id="empty" class="sub" style="margin-top:10px;display:none">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ØºØ±Ø§Ø¶ Ù…Ø·Ø§Ø¨Ù‚Ø©. Ø¬Ø±Ù‘Ø¨ Ø¨Ø­Ø« Ù…Ø®ØªÙ„Ù Ø£Ùˆ Ø£Ø¶Ù ØºØ±Ø¶ Ø¬Ø¯ÙŠØ¯.</div>
  </section>
</main>

<div id="toast" class="toast"></div>

<script>
/** ====== Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ====== **/
const STORAGE_KEY = "warehouse_house_cache_v3";

/** Ø¶Ø¹ Ø±Ø§Ø¨Ø· Google Apps Script Web App (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) **/
const ENDPOINT = "https://script.google.com/macros/s/AKfycbzkQiHa8cnTaMcLk_INiDP_6IR5tCJ6wND93z7JsNp0GnIGud4QLc_XvOQiTICK7QVvFg/exec";

/** ====== Ø¹Ù†Ø§ØµØ± ====== **/
const els = {
  syncState: document.getElementById("syncState"),
  modePill: document.getElementById("modePill"),
  editId: document.getElementById("editId"),
  editImageDataUrl: document.getElementById("editImageDataUrl"),
  name: document.getElementById("name"),
  category: document.getElementById("category"),
  shelf: document.getElementById("shelf"),
  side: document.getElementById("side"),
  level: document.getElementById("level"),
  zone: document.getElementById("zone"),
  notes: document.getElementById("notes"),
  image: document.getElementById("image"),
  btnSave: document.getElementById("btnSave"),
  btnClear: document.getElementById("btnClear"),
  btnSync: document.getElementById("btnSync"),
  btnDelete: document.getElementById("btnDelete"),
  search: document.getElementById("search"),
  filterShelf: document.getElementById("filterShelf"),
  filterCat: document.getElementById("filterCat"),
  list: document.getElementById("list"),
  empty: document.getElementById("empty"),
  count: document.getElementById("count"),
};

let cache = { items: [] };

/** ====== Ø£Ø¯ÙˆØ§Øª ====== **/
function toast(msg){
  const el = document.getElementById("toast");
  el.textContent = msg;
  el.classList.add("show");
  clearTimeout(window.__toastTimer);
  window.__toastTimer = setTimeout(()=> el.classList.remove("show"), 2200);
}

function setSyncState(t){ els.syncState.textContent = t; }

function escapeHtml(str){
  return (str ?? "").toString()
    .replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;")
    .replaceAll('"',"&quot;").replaceAll("'","&#039;");
}

function newid(){ return "i_" + Date.now().toString(36) + "_" + Math.random().toString(36).slice(2,8); }

function toDataUrl(file){
  return new Promise((resolve, reject)=>{
    const r = new FileReader();
    r.onload = ()=> resolve(r.result);
    r.onerror = ()=> reject(r.error);
    r.readAsDataURL(file);
  });
}

/** ====== Ù…Ø­Ù„ÙŠ ====== **/
function loadLocal(){
  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    if(raw){
      const data = JSON.parse(raw);
      if(data && Array.isArray(data.items)){
        cache = data;
      }
    }
  }catch(e){
    console.error(e);
  }
}

function saveLocal(){
  try{
    localStorage.setItem(STORAGE_KEY, JSON.stringify(cache));
  }catch(e){
    console.error(e);
    toast("ØªØ¹Ø°Ø± Ø§Ù„Ø­ÙØ¸ Ø§Ù„Ù…Ø­Ù„ÙŠ (Ù‚Ø¯ ØªÙƒÙˆÙ† ÙÙŠ ÙˆØ¶Ø¹ Ø®Ø§Øµ)");
  }
}

/** ====== Ø¹Ø±Ø¶ ====== **/
function matchesSearch(it){
  if(it.deleted) return false;

  const q = (els.search.value || "").trim().toLowerCase();
  if(q){
    const hay = `${it.name||""} ${it.notes||""} ${it.zone||""} ${it.category||""} ${it.shelf||""}`.toLowerCase();
    if(!hay.includes(q)) return false;
  }

  const fs = els.filterShelf.value;
  if(fs && it.shelf !== fs) return false;

  const fc = els.filterCat.value;
  if(fc && it.category !== fc) return false;

  return true;
}

function render(){
  const items = (cache.items||[])
    .filter(matchesSearch)
    .sort((a,b)=> (b.updatedAt||0)-(a.updatedAt||0));

  els.count.textContent = items.length;
  els.list.innerHTML = "";
  els.empty.style.display = items.length ? "none" : "block";

  for(const it of items){
    const div = document.createElement("div");
    div.className = "item";
    div.innerHTML = `
      <div class="thumb">${it.imageDataUrl ? `<img src="${it.imageDataUrl}" alt="">` : "ğŸ“¦"}</div>
      <div class="meta">
        <div class="name">${escapeHtml(it.name)}</div>
        <div class="sub">
          ${it.category ? `ØªØµÙ†ÙŠÙ: <b>${escapeHtml(it.category)}</b> â€¢ ` : ""}
          Ø§Ù„Ù…ÙˆÙ‚Ø¹: <b>${escapeHtml(it.zone||"")}${it.zone? " - ":""}${escapeHtml(it.shelf||"")}${it.shelf?" ":""}${escapeHtml(it.side||"")}${it.side?" ":""}${escapeHtml(it.level||"")}</b>
          ${it.notes ? " â€¢ " + escapeHtml(it.notes) : ""}
        </div>
      </div>
      <div class="actions">
        <button class="btn" data-act="edit" data-id="${it.id}">ØªØ¹Ø¯ÙŠÙ„</button>
        <button class="btn btn-danger" data-act="del" data-id="${it.id}">Ø­Ø°Ù</button>
      </div>
    `;
    els.list.appendChild(div);
  }
}

/** ====== Ù†Ù…ÙˆØ°Ø¬ ====== **/
function resetForm(){
  els.editId.value = "";
  els.editImageDataUrl.value = "";
  els.name.value = "";
  els.category.value = "";
  els.shelf.value = "";
  els.side.value = "";
  els.level.value = "";
  els.zone.value = "";
  els.notes.value = "";
  els.image.value = "";
  els.modePill.textContent = "ÙˆØ¶Ø¹ Ø§Ù„Ø¥Ø¶Ø§ÙØ©";
  els.btnDelete.classList.add("hidden");
}

function fillForm(it){
  els.editId.value = it.id;
  els.editImageDataUrl.value = it.imageDataUrl || "";
  els.name.value = it.name || "";
  els.category.value = it.category || "";
  els.shelf.value = it.shelf || "";
  els.side.value = it.side || "";
  els.level.value = it.level || "";
  els.zone.value = it.zone || "";
  els.notes.value = it.notes || "";
  els.image.value = "";
  els.modePill.textContent = "ÙˆØ¶Ø¹ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„";
  els.btnDelete.classList.remove("hidden");
}

/** ====== Ø­ÙØ¸ ====== **/
async function saveItem(){
  const name = (els.name.value||"").trim();
  if(!name){ toast("Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„ØºØ±Ø¶"); return; }

  const shelf = (els.shelf.value||"").trim();
  if(!shelf){ toast("Ø§Ø®ØªØ± Ø±Ù‚Ù… Ø§Ù„Ø±Ù"); return; }

  let imageDataUrl = els.editImageDataUrl.value || "";
  if(els.image.files && els.image.files[0]){
    imageDataUrl = await toDataUrl(els.image.files[0]);
  }

  const now = Date.now();
  const id = els.editId.value || newid();

  const item = {
    id,
    name,
    category: els.category.value || "",
    shelf,
    side: els.side.value || "",
    level: els.level.value || "",
    zone: (els.zone.value||"").trim(),
    notes: (els.notes.value||"").trim(),
    imageDataUrl,
    updatedAt: now,
    deleted: false
  };

  const idx = (cache.items||[]).findIndex(x=>x.id===id);
  if(idx>=0) cache.items[idx] = item;
  else cache.items.unshift(item);

  saveLocal();
  render();
  toast("ØªÙ… Ø§Ù„Ø­ÙØ¸ âœ…");
  resetForm();
}

/** ====== Ø­Ø°Ù ====== **/
function deleteItem(id){
  const idx = (cache.items||[]).findIndex(x=>x.id===id);
  if(idx<0) return;
  cache.items.splice(idx,1);
  saveLocal();
  render();
  toast("ØªÙ… Ø§Ù„Ø­Ø°Ù");
  resetForm();
}

/** ====== Ù…Ø²Ø§Ù…Ù†Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) ======
    Ø¥Ø°Ø§ ÙƒØ§Ù† CORS ÙŠÙ…Ù†Ø¹ Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø²ÙƒØŒ Ø³ØªÙØ´Ù„ (ÙˆÙ‡Ø°Ø§ Ø·Ø¨ÙŠØ¹ÙŠ Ø¹Ù„Ù‰ GitHub Pages).
**/
async function cloudGet(){
  if(!ENDPOINT) { toast("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ø§Ø¨Ø· Ù…Ø²Ø§Ù…Ù†Ø©"); return; }
  setSyncState("ØªØ­Ù…ÙŠÙ„...");
  try {
    const res = await fetch(ENDPOINT, { cache:"no-store" });
    const data = await res.json();
    if(data && Array.isArray(data.items)){
      cache = data;
      saveLocal();     // Ù…Ù‡Ù…: Ù†Ø®Ø²Ù† Ù…Ø­Ù„ÙŠÙ‹Ø§ Ø­ØªÙ‰ Ù„Ùˆ ÙØµÙ„Øª
      render();
      setSyncState("Ù…ØªØµÙ„");
      toast("ØªÙ… Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ù…Ù† Ø§Ù„Ø³Ø­Ø§Ø¨Ø© âœ…");
    } else {
      throw new Error("bad data");
    }
  } catch (e) {
    console.error(e);
    setSyncState("ØºÙŠØ± Ù…ØªØµÙ„");
    toast("ØªØ¹Ø°Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ù…Ù† Ø§Ù„Ø³Ø­Ø§Ø¨Ø© (CORS/Ø§ØªØµØ§Ù„)");
  }
}

async function cloudSave(){
  if(!ENDPOINT) { toast("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ø§Ø¨Ø· Ù…Ø²Ø§Ù…Ù†Ø©"); return; }
  setSyncState("Ø­ÙØ¸...");
  try{
    const res = await fetch(ENDPOINT, {
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body: JSON.stringify({ data: cache })
    });
    if(!res.ok) throw new Error("save failed");
    setSyncState("Ù…ØªØµÙ„");
    toast("ØªÙ…Øª Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© âœ…");
  }catch(e){
    console.error(e);
    setSyncState("ØºÙŠØ± Ù…ØªØµÙ„");
    toast("ØªØ¹Ø°Ø± Ø±ÙØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (CORS/Ø§ØªØµØ§Ù„)");
  }
}

/** ====== Ø£Ø­Ø¯Ø§Ø« ====== **/
els.btnSave.addEventListener("click", ()=> saveItem());
els.btnClear.addEventListener("click", ()=> resetForm());
els.btnSync.addEventListener("click", async ()=>{
  // Ø¬Ø±Ù‘Ø¨ Ø±ÙØ¹ Ø«Ù… ØªØ­Ù…ÙŠÙ„
  await cloudSave();
  await cloudGet();
});

els.btnDelete.addEventListener("click", ()=>{
  const id = els.editId.value;
  if(!id) return;
  if(confirm("Ø­Ø°Ù Ø§Ù„ØºØ±Ø¶ØŸ")) deleteItem(id);
});

els.search.addEventListener("input", render);
els.filterShelf.addEventListener("change", render);
els.filterCat.addEventListener("change", render);

els.list.addEventListener("click", (e)=>{
  const btn = e.target.closest("button[data-act]");
  if(!btn) return;
  const id = btn.getAttribute("data-id");
  const act = btn.getAttribute("data-act");
  const it = (cache.items||[]).find(x=>x.id===id);
  if(!it) return;

  if(act==="edit"){ fillForm(it); window.scrollTo({top:0,behavior:"smooth"}); }
  if(act==="del"){ if(confirm("Ø­Ø°Ù Ø§Ù„ØºØ±Ø¶ØŸ")) deleteItem(id); }
});

/** ====== Ø¨Ø¯Ø¡ ====== **/
(function init(){
  loadLocal();
  render();
  setSyncState("Ø¬Ø§Ù‡Ø²");
})();
</script>
</body>
</html>
